<!DOCTYPE html>
<html lang="th">
  <head>
    <meta charset="utf-8" />
    <title>Map Viewer</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Favicon -->
    <link rel="icon" href="favicon.ico" type="image/x-icon" />

    <!-- Leaflet CSS -->
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    />

    <style>
      body {
        margin: 0;
        font-family: sans-serif;
      }
      #map {
        width: 100%;
        height: 100vh;
      }

      /* Share button */
      #shareBtn {
        z-index: 99999;
        position: fixed;
        bottom: 20px;
        right: 20px;
        background: #0078ff;
        color: white;
        border: none;
        padding: 12px 18px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 14px;
        box-shadow: 0px 3px 10px rgba(0, 0, 0, 0.2);
      }
      #shareBtn:hover {
        background: #0065d0;
      }

      /* Toast Notification */
      #toast {
        position: fixed;
        top: 20px;
        right: 20px;
        background: #0078ff;
        color: white;
        padding: 12px 18px;
        border-radius: 8px;
        font-size: 14px;
        box-shadow: 0px 3px 10px rgba(0, 0, 0, 0.2);
        opacity: 0;
        transform: translateY(-15px);
        transition: 0.35s;
        z-index: 9999;
      }
      #toast.show {
        opacity: 1;
        transform: translateY(0);
      }
    </style>
  </head>

  <body>
    <div id="map"></div>
    <button id="shareBtn">แชร์แผนที่</button>
    <div id="toast">ข้อความ</div>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <script>
      // --- Toast Function ---
      function showToast(msg) {
        const toast = document.getElementById("toast");
        toast.textContent = msg;
        toast.classList.add("show");

        setTimeout(() => toast.classList.remove("show"), 2000);
      }

      // --- Read lat/lon and name from URL ---
      function getMarkersFromURL() {
        const params = new URLSearchParams(window.location.search);
        const list = params.get("latlon");

        if (!list) return [];

        return list.split("|").map((item) => {
          const [lat, lon, name] = item.split(",");
          return {
            lat: parseFloat(lat),
            lon: parseFloat(lon),
            name: name || "Unknown",
          };
        });
      }

      // --- Initialize Map ---
      const map = L.map("map").setView([15, 100], 5);

      L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
        maxZoom: 19,
      }).addTo(map);

      const markers = getMarkersFromURL();
      const bounds = [];

      markers.forEach((m) => {
        const marker = L.marker([m.lat, m.lon]).addTo(map);
        marker.bindTooltip(m.name, {
          permanent: true,
          direction: "top",
          offset: [-15, -12],
        });
        // เพิ่ม popup ให้มีปุ่มเปิด Google Maps
  const gmUrl = `https://www.google.com/maps?q=${m.lat},${m.lon}`;
  marker.bindPopup(`<b>${m.name}</b><br><a href="${gmUrl}" target="_blank">Open in Google Maps</a>`);
        bounds.push([m.lat, m.lon]);
      });

      if (bounds.length > 0) {
        map.fitBounds(bounds, { padding: [30, 30] });
      }

      // --- Share Button ---
      document
        .getElementById("shareBtn")
        .addEventListener("click", async () => {
          const url = window.location.href;

          try {
            await navigator.clipboard.writeText(url);
            showToast("คัดลอกลิงก์แล้ว ✔");
          } catch (e) {
            showToast("คัดลอกไม่สำเร็จ");
          }
        });
    </script>
  </body>
</html>
